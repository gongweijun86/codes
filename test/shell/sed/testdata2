
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Language" content="zh-cn" />

<meta http-equiv="Content-Type" content="text/html; charset=GBK" />

<meta name="keywords" content="北京邮电大学,BBS,北邮,BUPT,论坛,BYR,北邮人,北邮人论坛,nforum,xw2423" />

<meta name="description" content="北京邮电大学BBS" />

<meta name="author" content="xw2423@BYR" />

<title>
【求助】网页信息抓取问题
</title>

<link rel="shortcut icon" type="image/x-icon" href="http://static.byr.cn/favicon.ico">

<link rel="stylesheet" type="text/css" href="http://static.byr.cn/ccss/common.css" />

<link rel="stylesheet" type="text/css" href="http://static.byr.cn/ccss/ubb.css" />

<link rel="stylesheet" type="text/css" href="http://static.byr.cn/ccss/article.css" />

<link rel="stylesheet" type="text/css" href="http://static.byr.cn/ccss/ansi.css" />

</head>

<body>

<div id="header">

<div id="right-menu">

<ul>

<li>

<a href="/board/Cooperation">
合作交流
</a>

</li>

<li>

<a href="/board/BBShelp">
论坛帮助
</a>

</li>

<li>

<a href="/flink">
友情链接
</a>

</li>

<li>

<a href="/board/Advice">
意见建议
</a>

</li>

</ul>

</div>

<div id="logo">

<a href="/default">

<img src="http://static.byr.cn/img/logo.gif" />

</a>

</div>

<div id="ban_ner">

<object codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="600" height="80">

<param value="never" name="allowScriptAccess"/>

<param value="false" name="allowFullScreen"/>

<param value="http://static.byr.cn/files/swf/adv.swf" name="movie"/>

<param value="high" name="quality"/>

<param value="false" name="menu"/>

<param value="borderwidth=600&borderheight=80&pics=http://static.byr.cn/files/adv/2011-07-22-00-22-54.jpg&links=http%3A%2F%2Fbbs.byr.cn%2Farticle%2FAimBUPT%2F39094" name="FlashVars"/>

<embed pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" allowfullscreen="false" allowscriptaccess="never" quality="high" menu="false" src="/files/swf/adv.swf" width="600px" height="80px" FlashVars="borderwidth=600&borderheight=80&pics=http://static.byr.cn/files/adv/2011-07-22-00-22-54.jpg&links=http%3A%2F%2Fbbs.byr.cn%2Farticle%2FAimBUPT%2F39094" />

</object>

</div>

</div>

<div id="menu" class="m-hide">

<div id="u_login_wrap">

<div class="u-login">

<form class="user_login_form" action="/login?from=/article/NetTechnology/5772" method="post">

<div>

<span>
帐号:
</span>

<input type="text" id="id" class="input-text input" name="id"/>

</div>

<div>

<span>
密码:
</span>

<input type="password" id="pwd" class="input-text input" name="passwd"/>

</div>

<div class="l-check">

<input type="checkbox" id="c_auto" name="CookieDate" value="2"/>

<label for="c_auto">
下次自动登录
</label>

</div>

<div class="b-op">

<input type="submit" id="bb_login" class="submit" value="登录" />

<input class="submit" type="button" value="注册" id="bb_reg"/>

</div>

</form>

</div>

</div>

<div id="left-line">

<samp class="ico-pos-hide">

</samp>

</div>

<div id="xlist_wrap">

<div id="xlist">

<ul>

<li class="slist">

<span class="x-folder">

<span class="toggler">

</span>

<a href="javascript:void(0);">
全部讨论区
</a>

</span>

<ul class="x-child ajax">

<li>
{url:/slist?uid=guest&root=list-section}
</li>

</ul>

</li>

<li class="clist">

<span class="x-folder">

<span class="toggler">

</span>

<a href="javascript:void(0)">
控制面板
</a>

</span>

<ul class="x-child" id="list-control">

<li class="leaf">

<span class="text">

<a href="/user/query" >

<samp class="ico-pos-dot">

</samp>
查询用户
</a>

</span>

</li>

<li class="leaf">

<span class="text">

<a href="/s" >

<samp class="ico-pos-dot">

</samp>
搜索文章
</a>

</span>

</li>

</ul>

</li>

<li>

<span class="x-leaf">

<span class="toggler">

</span>

<a href="/vote">
投票系统
</a>

</span>

</li>

<li>

<span class="x-leaf">

<span class="toggler">

</span>

<a href="/chat">
聊天系统
</a>

</span>

</li>

<li>

<span class="x-leaf">

<span class="toggler">

</span>

<a href="http://m.byr.cn">
手机版
</a>

</span>

</li>

<li>

<span class="x-leaf">

<span class="toggler">

</span>

<a href="/design">
北邮人设计
</a>

</span>

</li>

<li>

<span class="x-leaf">

<span class="toggler">

</span>

<a href="/elite/path">
精华区
</a>

</span>

</li>

<li>

<span class="x-leaf">

<span class="toggler">

</span>

<a href="/pc/pcmain.html">
北邮人博客
</a>

</span>

</li>

<li>

<span class="x-leaf">

<span class="toggler">

</span>

<a href="telnet://bbs.byr.cn">
Telnet登录
</a>

</span>

</li>

<li>

<span class="x-leaf x-search">

<span class="toggler">

</span>

<input type="text" class="input-text" value="搜索讨论区" id="b_search"/>

</span>

</li>

</ul>

</div>

</div>

<div id="adv">

<a href="http://bbs.byr.cn/article/Focus/40185" target="_blank">

<img src="http://static.byr.cn/files/adv/2011-04-22-18-17-39.jpg" />

</a>

<a href="http://bbs.byr.cn/article/Focus/39660" target="_blank">

<img src="http://static.byr.cn/files/adv/2011-03-14-13-52-06.jpg" />

</a>

<a href="http://bbs.byr.cn/article/Focus/40899" target="_blank">

<img src="http://static.byr.cn/files/adv/2011-06-13-23-46-33.jpg" />

</a>

<a href="http://bbs.byr.cn/article/Focus/38764" target="_blank">

<img src="http://static.byr.cn/files/adv/2010-12-31-15-18-32.jpg" />

</a>

<a href="http://www.tofun.cn" target="_blank">

<img src="http://static.byr.cn/files/adv/2011-07-26-21-57-31.gif" />

</a>

</div>

</div>

<div id="main_wrap">

<div id="main">

<div id="notice" class="corner">

<div id="time">
服务器时间:&ensp;2011-08-14 14:54
</div>

<div id="nav">

<a href="/default">
北京邮电大学-北邮人论坛
</a>
&ensp;>
>
&ensp;
<a href="/section/2">
学术科技
</a>
&ensp;>
>
&ensp;
<a href="/board/NetTechnology">
网络技术
</a>
&ensp;>
>
&ensp;阅读文章
</div>

</div>

<div id="body" class="corner">

<div class="t-pre">

<div class="page">

<ul class="pagination">

<li class="page-pre">
主题数:
<i>
2
</i>
&emsp;分页:
</li>

<li>

<ol title="分页列表" class="page-main">

<li class="page-select">

<a title="当前页">
1
</a>

</li>

</ol>

</li>

<li class="page-suf">

</li>

</ul>

</div>

<div class="t-btn">

<a href="/article/NetTechnology/post" id="b_post" class="button">
新话题
</a>

<a href="/article/NetTechnology/tmpl" id="b_tmpl" class="button">
模版发文
</a>

<a href="javascript:void(0)" id="goToReply" class="button">
快捷回复
</a>

</div>

</div>

<div class="b-head corner">

<span class="n-right">

<span style="color:#eee;display:inline-block;vertical-align:bottom" id="a_share" _u='http://bbs.byr.cn/article/NetTechnology/5772' _c='【求助】网页信息抓取问题'>
分享到:
</span>

</span>

<span class="n-left">
文章主题:&ensp;【求助】网页信息抓取问题
</span>

</div>

<div class="b-content corner">

<a name="a0">

</a>

<div class="a-wrap">

<table class="article">

<tr class="a-head">

<td class="a-left a-no-bottom a-no-top">

<span class="u-name">

<a href="/user/query/imwhatiam">
imwhatiam
</a>

</span>

<span class="u-sex" >

<samp title="男生哦 离线" class="ico-pos-offline-man" >

</samp>

</span>

</td>

<td class="a-no-bottom a-no-top">

<ul class="a-func">

<li>

<samp class="ico-pos-reply">

</samp>

<a href="/article/NetTechnology/post/5772" class="a-post">
回复
</a>

</li>

<li>

<samp class="ico-pos-template">

</samp>

<a href="/article/NetTechnology/tmpl?reid=5772" class="a-post">
模版回复
</a>

</li>

<li>

<samp class="ico-pos-forward">

</samp>

<a href="/article/forward/NetTechnology/5772" class="a-post">
转寄
</a>

</li>

<li>

<samp class="ico-pos-search">

</samp>

<a href="/s/article?b=NetTechnology&au=imwhatiam">
搜索
</a>

</li>

<li>

<samp class="ico-pos-recomend">

</samp>

<a href="/article/NetTechnology/focus/5772" onclick="return confirm('确认推荐此文章？')">
推荐
</a>

</li>

</ul>

<span class="a-pos">
楼主
</span>

</td>

</tr>

<tr class="a-body">

<td class="a-left a-info a-no-bottom a-no-top">

<div class="u-img">

<img src="http://static.byr.cn/uploadFace/I/imwhatiam.7188.JPG" width="120px" height="106px" />

</div>

<div class="u-uid">
imwhatiam
</div>

<dl class="u-info">

<dt>
等级
</dt>

<dd>
用户
</dd>

<dt>
文章
</dt>

<dd>
52
</dd>

<dt>
积分
</dt>

<dd>
797
</dd>

<dt>
星座
</dt>

<dd>
未知
</dd>

</dl>

</td>

<td class="a-content a-no-bottom a-no-top">

<p>
发信人: imwhatiam (imwhatiam), 信区: NetTechnology 
<br />
 标&nbsp;&nbsp;题: 【求助】网页信息抓取问题 
<br />
 发信站: 北邮人论坛 (Wed Aug&nbsp;&nbsp;3 11:04:33 2011), 站内 
<br />
&nbsp;&nbsp;
<br />
 求助呀，我要抓取所有的游泳馆及地址信息到excel，看下面总共有8页，不想翻八次页，想一次都抓取了；或者可以翻八页，但是简单操作一下就可以抓取，有没有高手赐教一下呀。 
<br />
&nbsp;&nbsp;
<br />
 excel的“数据”-“自网站”也太麻烦； 
<br />
&nbsp;&nbsp;
<br />
 据说有什么爬虫、蜘蛛的网页程序，不会呀。 
<br />
&nbsp;&nbsp;
<br />
 求教求教
<br />

<a target="_blank" href="/att/NetTechnology/5772/493">

<img border="0" title="单击此在新窗口浏览图片" src="/att/NetTechnology/5772/493" class="resizeable" />

</a>
 
<br />
 -- 
<br />
&nbsp;&nbsp;
<br />
 
<font class="f000">

</font>

<font class="f006">
※ 来源:·北邮人论坛 
<a target="_blank" href="http://bbs.byr.cn">
http://bbs.byr.cn
</a>
·[FROM: 111.164.142.*]
</font>

<font class="f000">
 
<br />
&nbsp;&nbsp;
<br />
 
</font>

</p>

</td>

</tr>

<tr class="a-bottom">

<td class="a-left a-no-top a-no-bottom">

<ul class="a-func a-func-info">

<li>

<samp class="ico-pos-query">

</samp>

<a href="/user/query/imwhatiam">
查看
</a>

</li>

<li>

<samp class="ico-pos-mess">

</samp>

<a href="/mail/reply/NetTechnology/5772?id=imwhatiam" class="a-post">
发信
</a>

</li>

<li>

<samp class="ico-pos-friend">

</samp>

<a href="/friend/add?id=imwhatiam" class="a-post">
加好友
</a>

</li>

</ul>

</td>

<td class="a-no-top a-no-bottom">

<a href="#" class="c63f a-back">
返回顶部
</a>

</td>

</tr>

</table>

</div>

<a name="a1">

</a>

<div class="a-wrap">

<table class="article">

<tr class="a-head">

<td class="a-left a-no-bottom a-no-top">

<span class="u-name">

<a href="/user/query/zzcc">
zzcc
</a>

</span>

<span class="u-sex" >

<samp title="性别保密哦 离线" class="ico-pos-offline-hide" >

</samp>

</span>

</td>

<td class="a-no-bottom a-no-top">

<ul class="a-func">

<li>

<samp class="ico-pos-reply">

</samp>

<a href="/article/NetTechnology/post/5778" class="a-post">
回复
</a>

</li>

<li>

<samp class="ico-pos-forward">

</samp>

<a href="/article/forward/NetTechnology/5778" class="a-post">
转寄
</a>

</li>

<li>

<samp class="ico-pos-search">

</samp>

<a href="/s/article?b=NetTechnology&au=zzcc">
搜索
</a>

</li>

</ul>

<span class="a-pos">
第1楼
</span>

</td>

</tr>

<tr class="a-body">

<td class="a-left a-info a-no-bottom a-no-top">

<div class="u-img">

<img src="http://static.byr.cn/uploadFace/Z/zzcc.8503.jpg" width="96px" height="120px" />

</div>

<div class="u-uid">
Binux &lt;足兆叉虫&gt;
</div>

<dl class="u-info">

<dt>
等级
</dt>

<dd>
用户
</dd>

<dt>
文章
</dt>

<dd>
2379
</dd>

<dt>
积分
</dt>

<dd>
2443
</dd>

</dl>

</td>

<td class="a-content a-no-bottom a-no-top">

<p>
发信人: zzcc (Binux &lt;足兆叉虫&gt;), 信区: NetTechnology 
<br />
 标&nbsp;&nbsp;题: Re: 【求助】网页信息抓取问题 
<br />
 发信站: 北邮人论坛 (Thu Aug&nbsp;&nbsp;4 23:33:08 2011), 站内 
<br />
&nbsp;&nbsp;
<br />
 看下面总共有8页 ---- 这八页只是天津站的。。你只要天津的话手一个个复制都比写个程序快 
<br />
 不想翻八次页，想一次都抓取了 ---- 除非点评网有一个不带翻页的页面，不然不可能，而正好我写过这个的脚本，木有发现这样的页面 
<br />
 或者可以翻八页，但是简单操作一下就可以抓取 ---- 不写代码估计够呛。。试试js，反正页面数不多，挨个执行下好了 
<br />
&nbsp;&nbsp;
<br />
 自动导出？怎么可能那么智能啊！要是可以还要雇人干嘛 
<br />
 -- 
<br />
&nbsp;&nbsp;
<br />
 
<font class="f000">

</font>

<font class="f004">
※ 来源:·北邮人论坛 
<a target="_blank" href="http://bbs.byr.cn">
http://bbs.byr.cn
</a>
·[FROM: 123.122.11.*]
</font>

<font class="f000">
 
<br />
 
</font>

</p>

</td>

</tr>

<tr class="a-bottom">

<td class="a-left a-no-top a-no-bottom">

<ul class="a-func a-func-info">

<li>

<samp class="ico-pos-query">

</samp>

<a href="/user/query/zzcc">
查看
</a>

</li>

<li>

<samp class="ico-pos-mess">

</samp>

<a href="/mail/reply/NetTechnology/5778?id=zzcc" class="a-post">
发信
</a>

</li>

<li>

<samp class="ico-pos-friend">

</samp>

<a href="/friend/add?id=zzcc" class="a-post">
加好友
</a>

</li>

</ul>

</td>

<td class="a-no-top a-no-bottom">

<a href="#" class="c63f a-back">
返回顶部
</a>

</td>

</tr>

</table>

</div>

</div>

<div class="t-pre-bottom">

<div class="page">

<ul class="pagination">

<li class="page-pre">
主题数:
<i>
2
</i>
&emsp;分页:
</li>

<li>

<ol title="分页列表" class="page-main">

<li class="page-select">

<a title="当前页">
1
</a>

</li>

</ol>

</li>

<li class="page-suf">

</li>

</ul>

</div>

<div class="t-btn">

<form id="f_search" method="get" action="/s/article">

<input id="t_search" type="text" class="input-text input" name="t1" value="输入关键字" />

<input type="checkbox" name="m" id="c_m"/>

<label for="c_m">
精华帖
</label>

<input type="checkbox" name="a" id="c_a"/>

<label for="c_a">
带附件
</label>

<input type="submit" class="button" value="搜索" />

<input type="hidden" name="b" value="NetTechnology" />

</form>

</div>

</div>

<form id="f_post" method="post" action="/article/NetTechnology/post" >

<table id="quick_reply" class="corner">

<tr>

<td>

<textarea id="text_a" name="content">

</textarea>

</td>

<td id="quick_submit">

<input type="submit" class="button" value="快捷回复" />

</td>

</tr>

<tr>

<td colspan="2">

<div id="em_img">

</div>

</td>

</tr>

</table>

<input type="hidden" name="reid" value="5772" />

<input type="hidden" name="subject" value="Re%3A%20%A1%BE%C7%F3%D6%FA%A1%BF%CD%F8%D2%B3%D0%C5%CF%A2%D7%A5%C8%A1%CE%CA%CC%E2" />

</form>

</div>

</div>

</div>

<div id="footer">

<p class="footer_message">

<img src="http://static.byr.cn/img/logo_footer.gif" />
当前论坛上总共有注册用户
<span class="c-user">
1279
</span>
人
<br />
powered by BYR-Team&copy;2009.
<br />
all rights reserved
</p>

</div>

<script type="text/javascript">
var _gaq = _gaq || [];_gaq.push(['_setAccount', 'UA-2276167-2']);_gaq.push(['_trackPageview']);_gaq.push(['_trackPageLoadTime']);(function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();
</script>

<script type="text/javascript">
var config={domain:'bbs.byr.cn',base:'',prefix:'nforum',home:'/default',mWidth:1000,iframe:false,allowFrame:'/att/.*|/user/face'};var user_post=false;
</script>

<script type="text/javascript" src="http://static.byr.cn/cjs/jquery-1.4.4.pack.js">

</script>

<script type="text/javascript" src="http://static.byr.cn/cjs/forum.common.js">

</script>

<script type="text/javascript">
var nForumMap={_load:false,map:null,markers:[],geocoder:null,loadJs:function(name,opt){var url='http://maps.google.com/maps/api/js?sensor=false&region=GB&callback='+name;$.getScript(url);this.opt=opt},parseMap:function(){var option={zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDoubleClickZoom:true};$('.map-map').each(function(){var bound,marker;try{bound=eval('(['+$(this).attr('_bound').replace(/{/g,'[').replace(/}/g,']')+'])');marker=eval('(['+$(this).attr('_mark').replace(/{/g,'[').replace(/}/g,']')+'])')}catch(e){return}bound=new google.maps.LatLngBounds(new google.maps.LatLng(bound[0][0],bound[0][1]),new google.maps.LatLng(bound[1][0],bound[1][1]));option.center=bound.getCenter();var map=new google.maps.Map(this,option);map.fitBounds(bound);for(var i in marker){new google.maps.Marker({position:new google.maps.LatLng(marker[i][0],marker[i][1]),map:map})}})},init:function(){if(this._load)return;this._load=true;this.option={x:39.9042140,y:116.4074130,zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDoubleClickZoom:true};this.option.center=new google.maps.LatLng(this.option.x,this.option.y);this.map=new google.maps.Map(document.getElementById(this.opt.area),this.option);google.maps.event.addListener(this.map,'click',function(event){nForumMap.addMarker(event.latLng)});this.geocoder=new google.maps.Geocoder();$('#map_search').click(function(){nForumMap.search($('#map_txt').val())});$('#map_insert_btn').click(this.opt.onInsert)},addMarker:function(lo){var marker=new google.maps.Marker({position:lo,map:this.map,draggable:true});google.maps.event.addListenerOnce(marker,'click',function(event){marker.setMap(null);var len=nForumMap.markers.length;for(var i=0;i
<len;i++){if(marker==nForumMap.markers[i]){nForumMap.markers.splice(i,1)}}});this.markers.push(marker)},search:function(address){if(this.geocoder){this.geocoder.geocode({'address':address,'latLng':this.option.center},function(results,status){if(status==google.maps.GeocoderStatus.OK){var lo=results[0].geometry.location;nForumMap.map.setCenter(lo);nForumMap.map.fitBounds(results[0].geometry.viewport)}else{alert("很遗憾无法定位到任何结果，请使用范围较大的关键词进行定位，如:北京市海淀区xx路")}})}}};(jQuery.fn.extend({ubb:function(config){var ubb_config={enable:true,ubb_face:['宋体','楷体_GB2312','新宋体','黑体','隶书','Andale Mono','Arial','Arial Black','Courier New','Tahoma','Times New Roman','Verdana','Lucida Console'],ubb_size:["1","2","3","4","5","6","7","8","9"],ubb_color:["#FAEBD7","#00FFFF","#7FFFD4","#F0FFFF","#F5F5DC","#FFE4C4","#000000","#FFEBCD","#0000FF","#8A2BE2","#A52A2A","#DEB887","#5F9EA0","#7FFF00","#D2691E","#FF7F50","#6495ED","#FFF8DC","#DC143C","#00FFFF","#00008B","#008B8B","#B8860B","#A9A9A9","#006400","#BDB76B","#8B008B","#556B2F","#FF8C00","#9932CC","#8B0000","#E9967A","#8FBC8F","#483D8B","#2F4F4F","#00CED1","#9400D3","#FF1493","#00BFFF","#696969","#1E90FF","#B22222","#FFFAF0","#228B22","#FF00FF","#DCDCDC","#F8F8FF","#FFD700","#DAA520","#808080","#008000","#ADFF2F","#F0FFF0","#FF69B4","#CD5C5C","#4B0082","#FFFFF0","#F0E68C","#E6E6FA","#FFF0F5","#7CFC00","#FFFACD","#ADD8E6","#F08080","#E0FFFF","#FAFAD2","#90EE90","#D3D3D3","#FFB6C1","#FFA07A","#20B2AA","#87CEFA","#778899","#B0C4DE","#FFFFE0","#00FF00","#32CD32","#FAF0E6","#FF00FF","#800000","#66CDAA","#0000CD","#BA55D3","#9370DB","#3CB371","#7B68EE","#00FA9A","#48D1CC","#C71585","#191970","#F5FFFA","#FFE4E1","#FFE4B5","#FFDEAD","#000080","#FDF5E6","#808000","#6B8E23","#FFA500","#FF4500","#DA70D6","#EEE8AA","#98FB98","#AFEEEE","#DB7093","#FFEFD5","#FFDAB9","#CD853F","#FFC0CB","#DDA0DD","#B0E0E6","#800080","#FF0000","#BC8F8F","#4169E1","#8B4513","#FA8072","#F4A460","#2E8B57","#FFF5EE","#A0522D","#C0C0C0","#87CEEB","#6A5ACD","#708090","#FFFAFA","#00FF7F","#4682B4","#D2B48C","#008080","#D8BFD8","#FF6347","#40E0D0","#EE82EE","#F5DEB3","#FFFFFF","#F5F5F5","#FFFF00","#9ACD32"],ubb_img:[{id:'ubb_bold',alt:'加粗',src:'bold.gif'},{id:'ubb_italic',alt:'斜体',src:'italic.gif'},{id:'ubb_underline',alt:'下划线',src:'underline.gif'},{id:'ubb_url',alt:'链接',src:'url.gif'},{id:'ubb_mail',alt:'邮件',src:'mail.gif'},{id:'ubb_img',alt:'图片',src:'img.gif'},{id:'ubb_swf',alt:'Flash',src:'flash.gif'},{id:'ubb_mp3',alt:'音频',src:'music.gif'},{id:'ubb_map',alt:'地图',src:'map.gif'}],ubb_img_path:"",ubb_em:null,ubb_em_img:[{name:'经典',path:'em',start:1,num:74},{name:'悠嘻猴',path:'ema',start:0,num:42},{name:'兔斯基',path:'emb',start:0,num:25},{name:'洋葱头',path:'emc',start:0,num:59}]};config=$.extend(ubb_config,config);var textarea=this;textarea._getSelection=function(){var ret="";var doc=this.get(0).document;if(doc){var sel=doc.selection.createRange();if(sel.text.length>
0)ret=sel.text}else{var start=this.get(0).selectionStart,end=this.get(0).selectionEnd;if(start!=end)ret=this.get(0).value.substring(start,end)}return $.trim(ret)};textarea._makeUBB=function(template,valid){var txt=this._getSelection();if(txt==""&&valid){alert('请先选择文字');return false}var doc=this.get(0).document;var t=template.replace(/%content%/,txt);if(doc){this.get(0).focus();var range=doc.selection.createRange();if(range.text==""){this.get(0).value+=t}else{range.text=t;this.get(0).focus();range.collapse()}}else{var s=this.get(0).selectionStart,e=this.get(0).selectionEnd,val=this.get(0).value;this.get(0).value=val.substring(0,s)+t+val.substring(e)}this.focus()};if(config.enable){var wrap=document.createElement('div');$(wrap).attr("id","ubb_wrap");this.wrap(wrap);$('#ubb_wrap').prepend((function(){var ret="";ret+='字体&ensp;
<select id="ubb_face">
';for(var i in config.ubb_face){ret+='
<option value="'+config.ubb_face[i]+'">
'+config.ubb_face[i]+'
</option>
'}ret+='
</select>
&emsp;';ret+='字号&ensp;
<select id="ubb_size" >
';for(var i in config.ubb_size){ret+='
<option value="'+config.ubb_size[i]+'">
'+config.ubb_size[i]+'
</option>
'}ret+='
</select>
&emsp;';ret+='颜色&ensp;
<select id="ubb_color" >
';for(var i in config.ubb_color){ret+='
<option style="background-color:'+config.ubb_color[i]+';color:'+config.ubb_color[i]+'"value="'+config.ubb_color[i]+'">
'+config.ubb_color[i]+'
</option>
'}ret+='
</select>
';ret+='
<br />

<div class="ubb-icon">
';for(var i in config.ubb_img){ret+=('
<img id="'+config.ubb_img[i].id+'" src="'+config.ubb_img_path+config.ubb_img[i].src+'" alt="'+config.ubb_img[i].alt+'" title="'+config.ubb_img[i].alt+'"border="0">
')}return ret+'
</div>
'})());$('#ubb_color').change(function(){textarea._makeUBB("[color="+$(this).val()+"]%content%[/color]",true)});$('#ubb_size').change(function(){textarea._makeUBB("[size="+$(this).val()+"]%content%[/size]",true)});$('#ubb_face').change(function(){textarea._makeUBB("[face="+$(this).val()+"]%content%[/face]",true)});$('#ubb_bold').click(function(){textarea._makeUBB("[b]%content%[/b]",true)});$('#ubb_italic').click(function(){textarea._makeUBB("[i]%content%[/i]",true)});$('#ubb_underline').click(function(){textarea._makeUBB("[u]%content%[/u]",true)});$('#ubb_url').click(function(e){if(textarea._getSelection()==""){alert('请先选择文字');return false}var url=prompt("请输入链接网址\n请以http|https|ftp|rtsp|mms开头","http://");var reg=/^http|https|ftp|rtsp|mms:\/\//i;if(url==null)return false;if(!reg.test(url)){alert('非法的链接地址');return false}textarea._makeUBB("[url="+url+"]%content%[/url]",false)});$('#ubb_mail').click(function(e){if(textarea._getSelection()==""){alert('请先选择文字');return false}var mail=prompt('请输入电子邮件地址','XXX@domain');var reg=/^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/gi;if(mail==null)return false;if(!reg.test(mail)){alert('非法的邮件地址');return false}textarea._makeUBB("[email="+mail+"]%content%[/email]",false)});$('#ubb_img').click(function(e){var img=prompt('请输入图片地址','http://');var reg=/^http:\/\//i;if(img==null)return false;if(!reg.test(img)){alert('非法的图片地址');return false}textarea._makeUBB("[img="+img+"]%content%[/img]",false)});$('#ubb_swf').click(function(e){var swf=prompt("请输入Flash地址","http://");var reg=/^http:\/\//i;if(swf==null)return false;if(!reg.test(swf)){alert('非法的Flash地址');return false}textarea._makeUBB("[swf="+swf+"]%content%[/swf]",false)});$('#ubb_mp3').click(function(e){var mp3=prompt('请输入音频地址','http://');var reg=/^http:\/\//i;if(mp3==null)return false;if(!reg.test(mp3)){alert('非法的音频地址');return false}textarea._makeUBB("[mp3="+mp3+" auto=0]%content%[/mp3]",false)});var pop='
<div id="map_area">

<div id="map_canvas">

</div>

<div id="map_func">

<label>
输入一个大范围关键词定位&nbsp;&nbsp;
</label>

<input class="input-text" id="map_txt" type="textbox" value="" />
&nbsp;&nbsp;
<input class="submit" id="map_search" type="button" value="定位" />

<div id="map_insert">

<label>
单击地图添加一个可移动标记，单击标记删除
</label>
&nbsp;&nbsp;
<input class="submit" id="map_insert_btn" type="button" value="插入所有标记" />

</div>

</div>

</div>
';$('body').after(pop);$('#ubb_map').click(function(e){nForumMap.loadJs('nForumMap.init',{'area':'map_canvas','onInsert':function(){var m=nForumMap.markers,out=[],bound=nForumMap.map.getBounds(),b=[];b.push('{'+bound.getSouthWest().lat()+','+bound.getSouthWest().lng()+'}');b.push('{'+bound.getNorthEast().lat()+','+bound.getNorthEast().lng()+'}');for(var i in m){out.push('{'+m[i].getPosition().lat()+','+m[i].getPosition().lng()+'}')}if(out.length>
0){textarea._makeUBB("[map="+b.join(',')+" mark="+out.join(',')+"][/map]",false);$('#map_area').dialog('close')}else alert('请至少添加一个标记')}});$('#map_area').dialog({modal:true,resizable:false,autoOpen:true,title:"地图",width:600,zIndex:2,bgiframe:true})})}if(config.ubb_em&&config.ubb_em instanceof jQuery){var em=config.ubb_em,file=config.ubb_em_img,tab=$('
<div class="ubb-img-tab">

</div>
'),img=$('
<div class="ubb-img">

</div>
'),li='';for(var i in file){li+=('
<li _index="'+i+'" _cur="0" >

<div>
'+file[i].name+'
</div>

</li>
')}tab.append(li);function _img_update(n){var tmp='',path=file[n].path,start=file[n].start,num=file[n].num;for(var i=start;i
<num;i++){tmp+=('
<img src="'+config.ubb_img_path+path+'/'+i+'.gif" _val="'+i+'"/>
')}img.empty().append(tmp)}tab.find('li').click(function(){var _cur=$(this).attr('_cur');if(_cur=="1"){em.find('.ubb-img').toggle();return false}em.find('.ubb-img').show();tab.find("li").not($(this)).attr('_cur',"0").find('div').removeClass();$(this).attr('_cur',"1").find('div').addClass('selected');_img_update($(this).attr('_index'))});$('.ubb-img img').live("click",function(){textarea._makeUBB('['+file[tab.find('li[_cur="1"]').attr('_index')].path+$(this).attr('_val')+']',false)});em.append(tab);em.append(img)}return $(this)}}));;var BShare={sites:[{"title":"分享到新浪微博","url":"http://service.t.sina.com.cn/share/share.php?appkey=396731376&url=%url%&title=%content%&pic=&ralateUid=2005901751","img":'http://www.sinaimg.cn/blog/developer/wiki/16x16.png'},{"title":"分享到腾讯微博","url":"http://v.t.qq.com/share/share.php?url=%url%&title=%content%","img":'http://v.t.qq.com/share/images/s/weiboicon16.png'},{"title":"分享到搜狐微博","url":"http://t.sohu.com/third/post.jsp?url=%url%&title=%content%&content=utf-8","img":'http://s2.cr.itc.cn/img/t/152.png'},{"title":"分享到人人网","url":"http://www.connect.renren.com/share/sharer?url=%url%&title=%content%","img":'http://wiki.dev.renren.com/mediawiki/images/b/bd/Logo16.png'},{"title":"分享到开心网","url":"http://www.kaixin001.com/repaste/bshare.php?rurl=%url%&rtitle=%content%","img":'http://img1.kaixin001.com.cn/i3/platform/ico_kx16.gif'},{"title":"分享到豆瓣","url":"http://www.douban.com/recommend/?url=%url%&title=%content%","img":'http://img2.douban.com/pics/fw2douban_s.png'}],template:'
<img style="margin-left:5px;cursor:pointer;vertical-align:bottom;width:16px;height:16px;" title="%title%" src="%img%" />
',init:function(area,url,content){$(this.sites).each(function(i,e){var template=BShare.template;e.url=e.url.replace('%url%',encodeURIComponent(url));e.url=e.url.replace('%content%',encodeURIComponent(content));template=template.replace('%img%',e.img);template=template.replace('%title%',e.title);$(template).bind('click',e.url,BShare.handler).appendTo(area)})},handler:function(e){var f=function(){if(!window.open(e.data,'_blank','toolbar=0,resizable=1,scrollbars=yes,status=1,width=640,height=480'))location.href=e.data};if(/Firefox/.test(navigator.userAgent))setTimeout(f,0);else f()}};$(function(){$('.a-wrap').makeRC({in_head_border:"#D4E6FC",in_bottom_border:'#D4E6FC',in_head_bg:"#F3F5FC",in_bottom_bg:"#F3F5FC"});$('#goToReply').click(function(){$('#text_a').focus()});$('#t_search').mouseover(function(){$(this).select()});$('#text_a').mouseover(function(){$(this).focus()}).keydown(function(event){if(event.ctrlKey&&event.keyCode==13){$('#f_post').submit();return false}}).ubb({enable:false,ubb_img_path:config.base+"/img/ubb/",ubb_em:$('#em_img')});var validLogin=function(){if(!user_post&&!user_login){alert('请先登录!');return false}return true},validPost=function(){if(!validLogin())return false;if($.trim($('#text_a').val())==''){alert('不要回复空内容嘛!');return false}};$('#f_post').submit(validPost);$('#b_post').click(validLogin);$('#b_tmpl').click(validLogin);$('.a-post').click(validLogin);BShare.init($('#a_share').parent(),$('#a_share').attr('_u'),$('#a_share').attr('_c'));nForumMap.loadJs('nForumMap.parseMap',null)});$(function(){function serialize(){var data=[];$('#xlist .x-child').each(function(i,e){data[i]=$(e).is(':visible')?1:0});$.cookie("nforum-left",data.join(""),{path:'/',domain:config.domain,expires:30})}function deserialize(){var data=$.cookie("nforum-left")||"100";data=data.split("");$('#xlist .x-child').each(function(i,e){(data[i]=="1")&&$(e).parent().find('>
span .toggler').click()})}$('.slist').SimpleTree({autoclose:true,persist:true,cookie:"left-index",ajax:config.base+"/slist?uid="+uid+"&root=%id%"});$('.clist').SimpleTree({autoclose:true});if(uid!="guest")$('.flist').SimpleTree({autoclose:true,ajax:config.base+"/flist?uid="+uid+"&root=%id%"});deserialize();$("#xlist .x-child").parent().find('>
span .toggler').click(serialize);$("#xlist .x-folder").click(function(e){if(e.target!=$(this).children('.toggler').get(0))$(this).children('.toggler').click();return false});$("#xlist .x-leaf").not('.x-search').click(function(e){window.location.href=$(this).children('a').attr('href');return false});$('#left-line samp').click(function(){var s=!$(this).data("_show");$(this).toggleClass('ico-pos-show','ico-pos-hide').data("_show",s?1:0).css('right',s?-7:-12);$('#menu').width(s?156:0).children(':not(#left-line)')[s?"show":"hide"]().end().next().css("margin-left",s?162:3);$.cookie("left-show",s?1:0,{path:'/',domain:config.domain,expires:30})}).data("_show",1);if($.cookie("left-show")==0){$('#left-line samp').click()}$('#b_search').keydown(function(event){if(event.keyCode==13){window.location.href=config.base+'/s/board?b='+$(this).val()}}).mouseover(function(){$(this).select();return false});$('#bb_reg').click(function(){window.location.href=config.base+"/reg"});$('#u_login_wrap').makeRC({in_head_border:"#C3D9FF",in_head_bg:"#FFF",in_bottom_border:'#C3D9FF',in_bottom_bg:"#FFF",out_bg:"#ECF4FD"});$('#xlist_wrap').makeRC({in_head_border:"#C3D9FF",in_head_bg:"#ECF4FD",in_bottom_border:'#C3D9FF',in_bottom_bg:"#ECF4FD",out_bg:"#ECF4FD"})});
</script>

</body>

</html>
